[["index.html", "Chapter 1 简介", " Chapter 1 简介 日期: “2020-11-13” 作者：wxhyihuan 这份笔记主要是学习孙振球，徐勇勇老师的&lt;&gt; 第4版的过程中，尽量使用编程语言R对书中的示例进行实现的记录， 并用Bookdown形成此文档。 如果这份文档对您有所助益，或者您对文档有疑问或建议，您可以 邮件 告知我。 建议您购买原版教材学习，您也可以在网络上找到电子书方便参考。 &lt;&lt;医学统计学&gt;&gt; 孙振球, 徐勇勇. 第4版[M]. 人民卫生出版社, 2014. 本文档中联系使用到的软件 R 版本是4.0.3, 和 RStudio，版本是 1.3.1093 . 如果您R语言的新手，您可以在下面找到一些快速学习的资料： RStudio Cheatsheets R for Beginners sessionInfo() ## R version 4.0.3 (2020-10-10) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## Running under: Windows 10 x64 (build 19041) ## Matrix products: default ## locale: ## [1] LC_COLLATE=Chinese (Simplified)_China.936 ## [2] LC_CTYPE=Chinese (Simplified)_China.936 ## [3] LC_MONETARY=Chinese (Simplified)_China.936 ## [4] LC_NUMERIC=C ## [5] LC_TIME=Chinese (Simplified)_China.936 ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## loaded via a namespace (and not attached): ## [1] compiler_4.0.3 bookdown_0.21 htmltools_0.5.0 tools_4.0.3 ## [5] yaml_2.2.1 tinytex_0.27 rmarkdown_2.5 knitr_1.30 ## [9] digest_0.6.27 xfun_0.19 rlang_0.4.8 evaluate_0.14 "],["第二章-计量资料的统计描述.html", "Chapter 2 第二章 计量资料的统计描述 2.1 测试数据 2.2 输入数据和预处理 2.3 统计描述 2.4 正态分布和标准正态分布", " Chapter 2 第二章 计量资料的统计描述 日期: “2020-11-13” 作者：wxhyihuan 2.1 测试数据 Table 2.1: 某医院用随机抽样的方法检测了138名正常成年女子的红细胞数目(RBC， \\(*10^{12}/L\\)),其测量结果如下表： V1 V2 V3 V4 V5 V6 V7 V8 V9 V10 V11 V12 3.96 4.23 4.42 3.59 5.12 4.02 4.32 3.72 4.76 4.16 4.61 4.26 3.77 4.20 4.36 3.07 4.89 3.97 4.28 3.64 4.66 4.04 4.55 4.25 4.63 3.91 4.41 3.52 5.03 4.01 4.30 4.19 4.75 4.14 4.57 4.26 4.56 3.79 3.89 4.21 4.95 3.98 4.29 3.67 4.69 4.12 4.56 4.26 4.66 4.28 3.83 4.20 5.24 4.02 4.33 3.76 4.81 4.17 3.96 3.27 4.61 4.26 3.96 4.23 3.76 4.01 4.29 3.67 3.39 4.12 4.27 3.61 4.98 4.24 3.83 4.20 3.71 4.03 4.34 4.69 3.62 4.18 4.26 4.36 5.28 4.21 4.42 4.36 3.66 4.02 4.31 4.83 3.59 3.97 3.96 4.49 5.11 4.20 4.36 4.54 3.72 3.97 4.28 4.76 3.21 4.04 4.56 4.25 4.92 4.23 4.47 3.60 5.23 4.02 4.32 4.68 4.76 3.69 4.61 4.26 3.89 4.21 4.36 3.42 5.01 4.01 4.29 3.68 4.71 4.13 4.57 4.26 4.03 5.46 4.16 3.64 4.16 3.76 NA NA NA NA NA NA 2.2 输入数据和预处理 2.2.1 读取数据，并将数据转换成单列形式 RBC&lt;-read.table(&quot;ExampleData/02-01.txt&quot;,sep=&quot;\\t&quot;) RBC&lt;-as.matrix(RBC) RBC_q &lt;- c() for (i in seq(1:nrow(RBC))){ RBC_q &lt;- c(RBC_q, RBC[i,]) } RBC_v&lt;-as.vector(RBC_q) RBC_v&lt;-na.omit(RBC_v) 2.2.2 计算极差, max()/min()/range() #range(RBC_v) #返回最小值和最大值 rge&lt;-max(RBC_v)-min(RBC_v) rge ## [1] 2.39 2.2.3 确定组段数和组距 可以参考PAST软件中的the zero-stage rule of Wand 1997方式计算分段“最佳”个数。 \\(h=3.49min(s,IQ/1.349)n^{1/3}\\),其中s是样本标准差，IQ是四分位数范围。 #sd()计算标准差，quantile()计算分位数 s&lt;-sd(RBC_v) ## [1] 0.4457298 quan&lt;-quantile(RBC_v,c(0.25,0.75)) iq&lt;-quan[2]-quan[1] ## 0.565 h&lt;-3.49*min(s,iq/1.349)*(length(RBC_v)^(1/3)) ## 7.553617 h&lt;-ceiling(h) ## 8 i&lt;-rge/h 2.2.4 计算频数分布 根据计算的短组段数(h=8)，极差值(rge=2.39))和组距(i=rge/h=0.3164)计算各组段的频数 breaks = seq(min(RBC_v), max(RBC_v), length.out = 8) RBC_v.cut = cut(RBC_v, breaks, right=T,include.lowest=T) RBC_v.freq = table(RBC_v.cut) ## [3.07,3.41) [3.41,3.75) [3.75,4.09) [4.09,4.44) [4.44,4.78) ## 4 17 29 51 23 ## [4.78,5.12) [5.12,5.46) ## 9 4 hist(RBC_v, right=FALSE, breaks = breaks, labels =TRUE, freq = TRUE, col = &quot;#A8D6FF&quot;, border = &quot;white&quot;, ylim=c(0, max(RBC_v.freq))) hist(RBC_v, right=FALSE, breaks = breaks, labels =TRUE, freq = FALSE, col = &quot;#A8D6FF&quot;, border = &quot;white&quot;, ylim=c(0,1)) lines(density(RBC_v),col=&quot;red&quot;,lwd=2) Figure 2.1: 红细胞含量的频数分布 2.3 统计描述 2.3.1 算术平均值 算术均数简称均数(mean),用于反映组呈对称分布的变量值在数量上的平均水平。 mean(RBC_v) ## [1] 4.227029 2.3.2 几何平均值 几何均数(geometric mean)可用于反映一组经 对数转换 后呈对称分布的变量值在数量上的平均水平。 exp(mean(log(RBC_v))) ## [1] 4.203676 2.3.3 中位数与百分位数 中位数(median)是将n个变量值从小到大排列,位置居于中间的那个数。当为奇数时取位次居中 的变量值,当n为偶数时取位次居中的两个变量值的均数。 它适用于各种分布类型的资料,尤其是偏态分 布资料和一端或两端无确切数值的资料。 #中位数（=50百分位） median(RBC_v) quantile(RBC_v, 0.5) ## 4.23 #百分位 quantile(RBC_v, c(0.1, 0.25, 0.5,0.75,0.9)) ## 10% 25% 50% 75% 90% ##3.6670 3.9625 4.2300 4.5275 4.7750 2.3.4 极差 极差即一组变量值的最大值与最小值之差。 max(RBC_v)-min(RBC_v) range(RBC_v) 2.3.5 四分位间距(interquartile range) 四分位数(quartile)是把全部变量值分为四部分的分位数,即第1四分位数(Q .=Ps)、第2四分位数 M=P)、第3四分位数 (Qu=Ps)。 四分位数间距(quartile range)是由第3四分位数和第1四分位数相减行得, 记为 R.它般和中位数起描述偏态分们资料的分布特征 IQR(RBC_v) ## 0.565 quantile(RBC_v, 0.75)-quantile(RBC_v, 0.25) ## 0.565 2.3.6 方差与标准差 方差(variance)也称均方差(mean Square deviation),反映一组数据的平均离散水平。 标准差(standard deviation)是方差的正平方根,其单位与原变量值的单位相同。 sd(RBC_v) ## [1] 0.4457298 var(RBC_v) ## [1] 0.1986751 sd(RBC_v)^2 (sum((RBC_v-mean(RBC_v))^2))/(length(RBC_v)-1) ## 0.1986751 2.3.7 变异系数 变异系数(coefficient of variation)记为CV,多用于观察指标单位不同时。 sd(RBC_v)/mean(RBC_v)*100 ## [1] 10.54475 raster::cv(RBC_v) ## [1] 10.54475 2.4 正态分布和标准正态分布 正态分布（Normal distribution）又名高斯分布（Gaussian distribution），是一个非常常见的连续概率分布。 正态分布在统计学上十分重要，经常用在自然和社会科学来代表一个不明的随机变量。 可以说，弄懂正态分布是灵活运用统计学中各种假设检验方法、理解p值，均数置信区间的前提。 R包含有很丰富的正态分布相关的函数功能， 比如概率密度函数dnorm()，概率累积分布函数pnorm()，正态分位函数qnorm()和用来生成特定正态分布数据序列的函数rnorm()， 以及检测数据时候符合正态分布的方法，这里主要做下面一些介绍。 2.4.1 概率密度函数dnorm() 概率密度函数，Probability density function，R中即为dnorm()， 它可以给出了指定均值和标准差下每个点的概率分布的高度， 越高就代表着这个点/区间的概率越密集(大)。概率密度函数有时也被称为概率分布函数，但这种称法可能会和累积分布函数pnorm()混淆。 #在-10~10区间等分的 100个 数据集x x &lt;- seq(-10, 10, by = .1) #创建一个均值是2.5，标准差是0.5正态分布 y y &lt;- dnorm(x, mean = 2.5, sd = 0.5) #将 y 中的落在x数据集上的数据画出来 plot(x,y,col=&quot;red&quot;,pch=20) Figure 2.2: 概率密度函数示例 2.4.2 概率累积分布函数pnorm() 累积分布函数，Cumulative Distribution Function，R中即为pnorm()， 又叫分布函数，是概率密度函数的积分，能完整描述一个实随机变量X的概率分布，它给出一个正态分布中小于一个给定数字的累计概率(即指定定点的左边范围的曲线面积)。 #在-10~10区间等分的 40个 数据集x x &lt;- seq(-10, 10, by = .5) #创建一个均值是2.5，标准差是0.5正态分布 y y &lt;- pnorm(x, mean = 2.5, sd = 0.5) #将 y 中的落在x数据集上的累计概率画出来 plot(x,y,col=&quot;red&quot;,pch=20) Figure 2.3: 累积分布函数示例 2.4.3 正态分位函数qnorm() 正态分位函数，R中即为qnorm()，它可以给出一个累积分布概率达到指定值的数字。 #在0~1区间等分的 50个 数据集x x &lt;- x &lt;- seq(0, 1, by = 0.02) #创建一个均值是2，标准差是1正态分布 y y &lt;- qnorm(x, mean = 2, sd = 1) #将 y 中的落在x数据集上的数字画出来 plot(x,y,col=&quot;red&quot;,pch=20) Figure 2.4: 正态分位函数示例 2.4.4 指定正态分位函数rnorm() rnorm()函数用于生成符合指定均值和标准差的分布为正态分布的随机数，默认是标准正态分布，即均值为0，标准差1的正态分布。 #设置随机种子，便于重复后续的数据选取 set.seed(50) #在标准正态分布中随机选取50个数据 y &lt;- rnorm(50) #对选区的数据绘制频率分布图 hist(y,col=&quot;#A8D6FF&quot;,labels =TRUE) Figure 2.5: 随机正态分布数据示例 2.4.5 正态分布检验 许多计量资料的分析方法要求数据分布是正态或近似正态，因此对原始独立测定数据进行正态性检验是十分必要的。通过绘制数据的频数分布直方图来定性地判断数据分布正态性。 以下正态检验的资料整理自： 用R语言做正态分布检验 How to test the normality assumption 正态性检验主要有三类方法: 计算综合统计量 如动差法、夏皮罗-威尔克Shapiro-Wilk 法(W 检验) 、达戈斯提诺D′Agostino 法(D 检验) 、Shapiro-Francia 法(W′检验)。 正态分布的拟合优度检验 如皮尔逊χ2 检验 、对数似然比检验 、柯尔莫哥洛夫Kolmogorov-Smirov 法检验。 图示法(正态概率图Normal Probability plot) 如分位数图(Quantile Quantileplot ,简称QQ 图) 、百分位数(Percent Percent plot ,简称PP 图) 和稳定化概率图(Stablized Probability plot , 简称SP 图) 等。 统计软件中常用的正态性检验方法 用偏态系数和峰态系数检验数据正态性 偏态系数Sk,它用于检验不对称性;峰态系数Ku,它用于检验峰态。 S k= 0, K u= 0 时, 分布呈正态, S k&gt; 0 时, 分布呈正偏态,S k &lt; 0 时, 分布呈负偏态。适用条件：样本含量应大于200 用夏皮罗-威尔克(Shapiro-Wilk)法检验数据正态性 即W检验,1965 年提出,适用于样本含量n 50 时的正态性检;。 用达戈斯提诺(D′Agostino)法检验数据正态性 即D检验,1971提出,正态性D检验该方法效率高，是比较精确的正态检验法。 Shapiro-Francia 法 即W′检验,于1972 年提出,适用于50 &lt; n &lt; 100 时的正态性检验。 QQ图或PP图 散点聚集在固定直线的周围，可以认为数据资料近似服从正态分布 常用的规则： SPSS 规定:当样本含量3 n 5000 时,结果以Shapiro - Wilk (W 检验) 为难,当样本含量n &gt; 5000 结果以Kolmogorov - Smirnov 为准。 SAS 规定:当样本含量n 2000 时,结果以Shapiro - Wilk (W 检验) 为准,当样本含量n &gt;2000 时,结果以Kolmogorov - Smirnov (D 检验) 为准。 参考： 刘庆武,胡志艳，如何用SPSS、SAS 统计软件进行正态性检验，湘南学院学报(自然科学版)，2005 朱红兵，何丽娟，在SPSS10.0 中进行数据资料正态性检验的方法，首都体育学院学报，2004 2.4.5.1 直方图 直方图显示了分布的分布范围和形状，因此它是评估正态性的一个很好的起点。本文开始测试的红细胞浓度遵循正态曲线，因此数据似乎遵循正态分布。 hist(RBC_v, right=FALSE, breaks = breaks, labels =TRUE, freq = FALSE, col = &quot;#A8D6FF&quot;, border = &quot;white&quot;, ylim=c(0,1)) lines(density(RBC_v),col=&quot;red&quot;,lwd=2) Figure 2.6: 正态分布检验与直方图 2.4.5.2 密度图 密度图提供了关于数据是否服从正态分布的直观判断。它们类似于直方图，因为它们也允许分析分布的传播和形状。但是，它们是直方图的平滑版本。 maintxt&lt;-paste(&quot;N=&quot;,length(RBC_v),&quot;,&quot;,&quot;Mean=&quot;,round(mean(RBC_v),3),&quot;,&quot;,&quot;Sd=&quot;,round(s,3)) plot(density(RBC_v),col=&quot;red&quot;,lwd=2,main = maintxt) Figure 2.7: 正态分布检验与密度图 2.4.5.3 QQ-plot 有的数据从直方图和密度图很难检验正态性，因此建议用qq图来确证这些图。QQ-plot，又称正态图。在QQ-plots中， 我们只需要确定数据点是否沿着直线(有时也称为Henry’s line)，而不是查看数据的扩散情况(如直方图和密度图)。 如果点靠近参考线并且在置信区间内，则认为满足了正态性假设。点与参考线之间的偏差越大，偏离置信区间越远， 满足正态条件的可能性就越小。这12个成年人的身高似乎服从正态分布，因为所有的点都在置信区间内。 如果qq图所示的非正态分布(系统地偏离参考线)时，通常第一步是对数据进行对数变换， 并重新检查对数变换后的数据是否正态分布。可以应用log()函数进行对数变换。 另外，qq图也是评估回归分析的残差是否服从正态分布的一种方便的方法。 Figure 2.8: 难以判断正态分布的密度图 #qqPlot是car包中的函数，因此需要载入包 library(car) ## 载入需要的程辑包：carData set.seed(42) dat_hist &lt;- data.frame( value = rnorm(12, mean = 165, sd = 5)) ## qqPlot(dat_hist$value) Figure 2.9: 正态分布检验与QQ-plot (1) ## [1] 12 2 #qqPlot是car包中的函数，因此需要载入包 library(car) qqPlot(as.numeric(RBC_v),ylab=&quot;RBC&quot;, main=&quot;RBC QQ-plot&quot;) Figure 2.10: 正态分布检验与QQ-plot (2) 2.4.5.4 正态检验 上述3种方法是对常态的目视检查。然而，目测有时可能不可靠，因此也有可能通过统计检验正式检验数据是否服从正态分布。 这些正态性检验将数据的分布与正态分布进行比较，以评估观察结果是否显示出偏离正态性的重要偏差。 最常用的两种正态性检验是Shapiro-Wilk检验（K检验）和Kolmogorov-Smirnov检验（D检验）。两种测试都有相同的假设，即: H0 : 数据服从正态分布 H1 : 数据不服从正态分布 正态性检验推荐使用Shapiro-Wilk检验，因为它比Kolmogorov-Smirnov检验提供更好的效用。 在R中，正态性的Shapiro-Wilk检验可以通过函数shapiro.test()进行。 set.seed(42) dat_hist &lt;- data.frame( value = rnorm(12, mean = 165, sd = 5)) shapiro.test(dat_hist$value) ## Shapiro-Wilk normality test ## ## data: dat_hist$value ## W = 0.9, p-value = 0.5 从输出中，我们看到p-value&gt;0.05意味着我们不拒绝数据服从正态分布的原假设。 该检验与qq图的方向相同，qq图与正态性没有显著偏差(因为所有点都在置信区间内)。 shapiro.test(RBC_v) ## Shapiro-Wilk normality test ## ## data: as.numeric(RBC_v) ## W = 1, p-value = 0.4 对RBC数据同样的结果。 注意的是，在实践中，正态检验通常被认为过于保守，因为对于大样本(n&gt;50)，对正态条件的一个 小偏差可能会导致违反正态判断的条件。由于正态性检验是一种假设检验，所以随着样本量的增加，其检测较小差 异的能力也会增加。因此，随着观测数的增加，Shapiro-Wilk检验变得非常敏感，甚至对正态性的一个 微小偏差也非常敏感。所以，根据正态性检验，数据不服从正态分布，尽管偏离正态分布的情况可以忽略不计，但数据 实际上服从正态分布。因此，通常情况下，正态性条件的验证是基于本文所介绍的所有方法的组合，即目视检验 (使用直方图和q-q图)和正式化检验(例如使用shapio-wilk检验)。 R中还有其他一些正态检验的方法，比如 ks.test() 函数实现Kolmogorov-Smirnov Test（D检验）， 是对经验分布的拟合检验，检验的是经验分布函数和假设总体分布函数的差异，适应于大样本(n&gt;5000)。 另外有一些package包含了丰富的检验函数，比如fBasics，nortest等。 "]]
